<h1>Audit Log</h1>

<div class="row">
    <div class="span12">
        <table class="table table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Revision</th>
                    <th>Timestamp</th>
                    <th>Entities</th>
                    <th>User</th>
                </tr>
            </thead>

            <tfoot>
                <tr>
                    <td colspan="6">
                        <span class="label label-success">Insert</span>
                        <span class="label label-warning">Update</span>
                        <span class="label label-important">Delete</span>
                    </td>
                </tr>
            </tfoot>
            <tbody>
                <?php
                $i = 1 ;
                foreach ($revisions as $revision) {
                ?>
                    <tr>
                        <td><?php  echo $this->escapeHtml($i);?></td>
                        <td>
                            <a href="<?=
                                $this->url('audit/revisions',
                                    array(
                                        'rev' => $revision->getRevisionType()
                                    )
                                );
                            ?>">
                                <?php  echo $this->escapeHtml($revision->getRevisionType()); ?>
                            </a>
                        </td>

                        <td>
                            <a href="<?=
                                $this->url('audit/revisions',
                                    array(
                                        'rev' => $revision->getRevisionType()
                                    )
                                );
                            ?>">

                                <?php echo $this->AuditDateTimeFormatter($revision->getTimestamp()); ?>

                            </a>
                        </td>

                        <td>
                        <?php
                        foreach ($revision->getRevisionEntities() as $revisionEntity) {
                        ?>
                                <?php $id = $revisionEntity->getId(); ?>
                                <a href="<?=
                                    $this->url(
                                        'audit/entity',
                                        array(
                                            'id' => $id['id'],
                                            'className' => $revisionEntity->getEntityClass(),
                                        )
                                    );?>">
                            <span class="label label-<?php
                                switch ($revision->getRevisionType()) {
                                    case 'INS':
                                        echo 'success';
                                        break;
                                    case 'UPD':
                                        echo 'warning';
                                        break;
                                    case 'DEL':
                                        echo 'important';
                                        break;
                                    default:
                                        echo 'info';
                                }
                            ?>">

                                    <?php echo $this->escapeHtml($revisionEntity->getEntity()->getAuditedEntityClass()); ?>
                            </span>
                                </a>
                        <br>
                        <?php
                        $i++;
                        }
                        ?>
                        </td>

                        <td>
                            <span class="btn btn-default">
                                <?php
                                    if ($revision->getUser()) {
                                        echo $this->gravatar($revision->getUser()->getEmail(), array('img_size' => 24));
                                        echo ' ';
                                        echo $this->escapeHtml($revision->getUser()->getEmail());
                                    } else {
                                        echo $this->gravatar('anonymous@unknown.net', array('img_size' => 24));
                                        echo ' Anonymous';
                                    }
                                ?>
                            </span>
                        </td>
                    </tr>
                <?php
                }
                ?>
            </tbody>
        </table>
    </div>
    <div class="span6">

    </div>
</div>