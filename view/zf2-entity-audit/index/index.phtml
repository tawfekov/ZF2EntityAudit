<h1>Audit Log</h1>

<div class="row">
    <div class="span12">
        <table class="table table-striped table-hover table-bordered">
            <thead>
                <tr>
                    <th>Revision</th>
                    <th>Timestamp</th>
                    <th>Entities</th>
                    <th>User</th>
                </tr>
            </thead>

            <tfoot>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>
                        <span class="label label-success">Insert</span>
                        <span class="label label-warning">Update</span>
                        <span class="label label-important">Delete</span>
                    </td>
                    <td>&nbsp;</td>
                </tr>
            </tfoot>
            <tbody>
                <?php
                foreach ($revisions as $revision) {
                ?>
                    <tr>
                        <td>
                            <a href="<?=
                                $this->url('audit_viewrevision',
                                    array(
                                        'rev' => $revision->getRev()
                                    )
                                );
                            ?>">
                                <?= $revision->getRev(); ?>
                            </a>
                        </td>

                        <td>
                            <a href="<?=
                                $this->url('audit_viewrevision',
                                    array(
                                        'rev' => $revision->getRev()
                                    )
                                );
                            ?>">
                                <?= $revision->getTimestamp()->format("r"); ?>
                            </a>
                        </td>

                        <td>
                        <?php
                        $changedEntities = $this->auditReader->findEntitesChangedAtRevision($revision->getRev());
                        foreach ($changedEntities as $ce) {
                        ?>
                                <?php $id = $ce->getId(); ?>
                                <a href="<?=
                                    $this->url(
                                        'audit_viewentity',
                                        array(
                                            'id' => $id['id'],
                                            'className' => $ce->getClassName(),
                                        )
                                    );?>">
                            <span class="label label-<?php
                                switch ($ce->getRevisionType()) {
                                    case 'INS':
                                        echo 'success';
                                        break;
                                    case 'UPD':
                                        echo 'warning';
                                        break;
                                    case 'DEL':
                                        echo 'important';
                                        break;
                                    default:
                                        echo 'info';
                                }
                            ?>">


                                    <?= $ce->getClassName(); ?>
                            </span>
                                </a>
                        <br>
                        <?php
                        }
                        ?>
                        </td>

                        <td>
                            <span class="label label-info">
                                <?= ($revision->getUsername()) ?: 'Anonymous'; ?>
                            </span>
                        </td>
                    </tr>
                <?php
                }
                ?>
            </tbody>
        </table>
    </div>
    <div class="span6">

    </div>
</div>